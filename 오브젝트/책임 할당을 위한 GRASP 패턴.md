## 책임 할당을 위한 GRASP 패턴

GRASP는 객체에게 책임을 할당할 때 지침으로 삼을 수 있는 원칙들의 집합을 패턴 형식으로 정리한 것이다.

<br/>

## 도메인 개념에서 출발하기

설계를 시작하기 전에 도메인에 대한 개략적인 모습을 그려 보는 것이 유용하다.

책임 할당의 대상으로 사용하면 코드에 도메인의 모습을 투영하기가 좀 더 수월해진다.

```
어떤 책임을 할당해야 할 때 가장 먼저 고민해야 하는 유력한 후보는 바로 도메인 개념이다.
```

<br/>

그림을 통해 하나의 영화는 여러 번 상영될 수 있으며, 하나의 상영은 여러 번 예약될 수 있다는 사실을 알 수 있다.

또한 영화는 다수의 할인 조건을 가질 수 있으며 할인 조건에는 순번 조건과 기간 조건이 존재한다는 사실 역시 표현돼 있다.

![이미지](/img/오브젝트12.PNG)

설계를 시작하는 단계에서는 개념들의 의미와 관계가 정확하거나 완벽할 필요가 없다.

```
단지 우리에게는 출발점이 필요할 뿐이다.
```

<br/>

이 단계에서는 책임을 할당받을 객체들의 종류와 관계에 대한 정보를 제공할 수 있다면 성공이다.

중요한 것은 설계를 시작하는 것이지 도메인 개념들을 완벽하게 정리하는 것이 아니다.

<br/>

도메인 개념을 정리하는데 너무 많은 시간을 들이지 말고 빠르게 설계와 구현을 진행하라.

<br/><br/>

## 정보 전문가에게 책임을 할당하라

첫 단계는 애플리케이션이 제공해야 하는 기능을 애플리케이션의 책임으로 생각하는 것이다.

이 책임을 애플리케이션에 대해 전송된 메시지로 간주하고 이 메시지를 책임질 첫 번째 객체를 선택하는 것으로 설계를 시작한다.

<br/>

사용자에게 제공해야 하는 기능은 영화를 예매하는 것이다.

이를 책임으로 간주하면 애플리케이션은 영화를 예매할 책임이 있다고 말할 수 있다.

<br/>

이제 이 책임을 수행하는데 필요한 메시지를 결정해야 한다.

메시지는 메시지를 수신할 객체가 아니라 메시지를 전송할 객체의 의도를 반영해서 결정해야 한다.

<br/><br/>

## 따라서 첫 번째 질문은 다음과 같다.

```
"메시지를 전송할 객체는 무엇을 원하는가?"
```

협력을 시작하는 객체는 미정이지만, 이 객체가 원하는 것은 분명해 보인다.

바로 영화를 예매하는 것이다.

<br/>

따라서 메시지의 이름으로는 예매하라가 적절하다.

![이미지](/img/오브젝트13.PNG)

메시지를 결정 했으므로, 메시지에 적합한 객체를 선택해야 한다.

<br/><br/>

## 두번째 질문은 다음과 같다.

```
"메시지를 수신할 적합한 객체는 누구인가?"
```

객체가 상태와 행동을 통합한 캡슐화의 단위라는 사실에 집중해야 한다.

객체의 책임과 책임을 수행하는데 필요한 상태는 동일한 객체 안에 존재해야 한다.

<br/>

따라서, 객체에게 책임을 할당하는 첫 번째 원칙은 책임을 수행할 정보를 알고 있는 객체에게 책임을 할당하는 것이다. 

<br/>

(GRASP에서는 [information Expert] 패턴이라고 부른다)

하지만, 여기서 나온 정보 전문가 패턴이 데이터와 다르다는 사실에 주의하자.

<br/>

information Expert 패턴에 따르면 예매하는 데 필요한 정보를 가장 많이 알고 있는 

객체에게 ‘예매하라’ 메시지를 처리할 책임을 할당해야 한다.

```
“어떤 객체가 좋을까?” 
```

<br/>

아마 ‘상영’이라는 도메인 개념이 적합해 보인다.

상영은 영화에 대한 정보와 상영 시간, 상영 순번처럼 영화 예매에 필요한 다양한 정보를 알고 있다.

<br/>

따라서 영화 예매를 위한 정보 전문가다.

![이미지](/img/오브젝트14.PNG)

‘예매하라’ 메시지를 수신했을 때 Screening이 수행해야 하는 작업의 흐름을 생각해보자.

<br/>

이제부터는 외부의 인터페이스가 아닌 Screening의 내부로 들어가 메시지를 처리하기 위해 

필요한 절차와 구현을 고민해 보는 것이다.

```
만약, 스스로 처리할 수 없는 작업이 있다면 외부에 도움을 요청해야 한다.
```

<br/>

이 요청이 외부로 전송해야 하는 새로운 메시지가 되고, 최종적으로 이 메시지가 새로운 객체의 책임으로 할당된다.

이 같은 연쇄적인 메시지 전송과 수신을 통해 협력 공동체가 구성된다.

<br/>

‘예매하라’ 메시지를 완료하기 위해서는 예매 가격을 계산하는 작업이 필요하다.

예매 가격은 영화 한 편의 가격을 계산한 금액에 예매 인원수를 곱한 값으로 구할 수 있다.



따라서 영화 한편의 가격을 알아야 한다.

<br/>

하지만, Screening은 가격을 계산하는데 필요한 정보를 모르기 때문에 외부의 객체에게 도움을 요청해서 가격을 얻어야 한다.

외부에 대한 이 요청이 새로운 메시지가 된다.

<br/>

여기서 새로운 메시지의 이름으로는 ‘가격을 계산하라’ 가 적절해 보인다.

![이미지](/img/오브젝트15.PNG)

이제 메시지를 책임질 객체를 선택해야 한다.

<br/>

### 영화 가격을 계산하는데 필요한 정보를 알고 있는 전문가는 무엇인가?

당연히 영화(Movie) 이다. 이제 Movie는 영화 가격을 계산할 책임을 지게 된다.

![이미지](/img/오브젝트16.PNG)

<br/>

요금을 계산하기 위해서는 먼저 영화가 할인 가능한지를 판단한 후 할인 정책에 따라 할인 요금을 제외한 금액을 계산하면 된다.

```
이중에서 영화가 스스로 처리할 수 없는 일이 한가지 있다.
```

할인 조건에 따라 영화가 할인 가능한지를 판단하는 것이다.

따라서 Movie는 ‘할인 여부를 판단하라’ 메시지를 전송해서 외부의 도움을 요청해야 한다.



그리고 이제 메시지를 책임질 객체를 선택 해야한다.

<br/>

### 할인 여부를 판단 하는데 필요한 정보를 가장 많이 알고 있는 객체는 무엇인가?

이 정보에 대한 전문가는 바로 할인 조건이다.

![이미지](/img/오브젝트17.PNG)

Movie는 DiscountCondition에 전송한 ‘할인 여부를 판단하라’ 메시지의 결과로 할인 가능 여부를 반환 받는다.

<br/>

정책에 정해진 계산식에 따라 요금을 계산한 후 반환한다.

만약, 할인 가능한 조건이 존재하지 않는다면 영화의 기본 금액을 반환한다.

<br/><br/>

>**Reference** 
> <br/> [오브젝트](http://www.yes24.com/Product/Goods/74219491) <br/><br/>
>그림 참조 - [https://blogshine.tistory.com/225](https://blogshine.tistory.com/225)